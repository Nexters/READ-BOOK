## 3장. 컴퓨터 시스템의 동작 원리

#### 1. 컴퓨터 시스템의 구조

---

- 컴퓨터 내부장치(CPU, 메모리)
- 컴퓨터 외부장치(디스크, 키보드, 마우스, 모니터, 네트워크 장치)

컴퓨터는 외부장치에서 내부장치로 데이터를 읽어와 각종 연산을 수행한 후, 그 결과를 외부장치로 다시 내보내는 방식으로 업무를 처리함

이를 대표적인 입출력이라고 할 수 있으며, 따라서 컴퓨터 외부장치를 입출력 장치라고도 부름



#### 2. CPU 연산과 I/O 연산

---

컴퓨터에서 연산을 한다는 것은 CPU가 무언가 일을 한다는 뜻

각 장치마다 이를 제어하기 위해 설치된 장치 컨트롤러는 장치로부터 들어오고 나가는 데이터를 임시로 저장하기 위한 작은 메모리를 가지고 있음 -> 로컬버퍼

디스크나 키보드에서 데이터를 읽어오는 경우, 컨트롤러가 장치에서 로컬버퍼로 데이터를 저장하고 인터럽트를 발생시켜 CPU에 보고함



#### 3. 인터럽트의 일반적 기능

----

운영체제 개발자는 운영체제가 해야 할 일들을 미리 프로그래밍해서 커널 내에 포함시킴

그 중 하나가 인터럽트 처리루틴. 

인터럽트에는 하드웨어 인터럽트, 소프트웨어 인터럽트(트랩)가 있음

인터럽트가 발생했음을 알려주는 방식은 둘 다 동일함

하드웨어 인터럽트는 컨트롤러등 하드웨어 장치가 CPU의 인터럽트 라인을 세팅,

소프트웨어 인터럽트는 소프트웨어가 그 일을 수행함(ex. 예외상황, 시스템 콜)



#### 4. 인터럽트 핸들링

---

인터럽트 핸들링이란 인터럽트가 발생한 경우에 처리해야 할 일의 절차를 의미

CPU에서 명령이 실행될 때, CPU 내부에 있는 임시 기억장치인 레지스터에 데이터를 읽거나 쓰면서 작업을 하는데, 인터럽트가 발생해 새로운 명령을 실행하면 기존의 레지스터값들이 지워지므로 CPU 내의 상태를 저장해두어야 함.

저장은 프로세스 제어블록(PCB)에 하며, 인터럽트 처리가 끝나면 저장된 상태를 PCB로부터 CPU상에 복원함

오늘날의 컴퓨터에서 운영체제는 인터럽트가 발생할 때만 실행됨



#### 5. 입출력 구조

---

입출력 방식에는 1)**동기식 입출력**과 2)**비동기식 입출력**이 있음

**동기식 입출력** : 어떤 프로그램이 입출력 요청을 했을 때 입출력 작업이 완료된 후에야 그 프로그램이 후속 작업을 수행할 수 있는 방식 -> 자원 낭비

동기식 입출력에서는 입출력 요청의 동기화를 위해 장치별로 큐(queue)를 두어 요청한 순서대로 처리할 수 있도록 함 -> 컨트롤러는 이 순서에 따라 매 시점 하나씩 자신에게 주어진 입출력 작업을 처리함

**비동기식 입출력** : 입출력 연산을 요청한 후에 연산이 끝나기를 기다리는 것이 아니라 CPU의 제어권을 입출력 연산을 호출한 그 프로그램에게 곧바로 다시 부여하는 방식

비동기식 입출력에서는 요청과 관련 없는(?) 작업을 먼저 수행하고, 읽어오는 데이터가 반드시 있어야 수행할 수 있는 일들은 입출력이 완료된 후에 수행함

**일반적으로 동기식 입출력 사용함**



#### 6. DMA

---

원칙적으로 메모리는 CPU에 의해서만 접근할 수 있는 장치. 따라서 CPU 외의 장치가 메모리의 데이터에 접근하기 위해서 CPU에게 인터럽트를 발생시켜 CPU가 이를 대행하는 식으로만 가능 -> CPU 사용의 효율성이 떨어지는 문제점 발생

이런 비효율성을 극복하기 위해 **DMA(Direct Memory Access)** 라는 장치가 있음. 이는 일종의 컨트롤러로서, CPU가 입출력 장치들의 메모리 접근 요청에 의해 자주 인터럽트 당하는 것을 막아주는 역할을 함



#### 7. 저장장치의 구조

---

컴퓨터 시스템을 구성하는 저장장치는 1)**주기억장치**, 2)**보조기억장치**로 이루어짐

**주기억장치**는 보통 메모리라고 부르며 휘발성의 RAM을 매체로 사용하는 경우가 대부분

**보조기억장치**는 비휘발성의 마그네틱 디스크를 주로 사용. 용도가 크게 두 가지로 구분되는데, 1) 파일 시스템용, 2) 메모리의 연장 공간인 스왑 영역용이다. 



#### 8. 저장장치의 계층 구조

---

저장장치는 빠른 저장장치부터 느린 저장장치까지 단계적인 계층 구조로 이루어짐

빠른 저장장치는 단위 공간당 가격이 높기 때문에 적은 용량을 사용하며, 느린 저장장치는 가격이 저렴해 대용량을 사용하는 반면 접근속도가 느리다는 약점이 있음

주기억장치가 상위에 존재하며 보조기억장치는 하위에 존재

캐싱기법으로 수행 성능을 향상시킴

캐싱기법이란? 상대적으로 용량이 적은 빠른 저장장치를 이용해 느린 저장장치의 성능을 향상시키는 총체적 기법



#### 9. 하드웨어의 보안

---

운영체제는 여러 프로그램이 동시에 실행될 수 있는 다중 프로그래밍 환경에서 동작하므로, 하드웨어에 대한 각종 보안 기법이 필요함

이를 위해 운영체제는 기본적으로 1) **커널모드** 2) **사용자모드**를 지원.

**커널모드** : 운영체제가 CPU의 제어권을 가지고 운영체제 코드를 실행하는 모드. 이 모드에서는 모든 종류의 명령을 다 수행할 수 있음

**사용자모드** : 일반 사용자 프로그램이 실행되며 제한적인 명령만 수행 가능

-> 시스템에 중요한 영향을 미치는 연산은 커널모드에서만 실행 가능하도록 함으로써 하드웨어의 보안 유지



#### 10. 메모리 보안

---

메모리도 보안이 필요함. 여러 프로그램이 메모리에 동시에 올라가서 실행되기 때문에 하나의 사용자 프로그램이 다른 사용자 프로그램이나 운영체제가 위치한 메모리 영역을 침범할 수 있기 때문. 

이를 위해 1) **기준 레지스터**, 2) **한계 레지스터** 이 두개의 레지스터를 사용해서 프로그램이 접근하려는 메모리 부분이 합법적인지 체크함으로써 메모리 보호

**기준 레지스터**는 어떤 프로그램이 수행되는 동안 그 프로그램이 합법적으로 접근할 수 있는 메모리상의 가장 작은 주소를 보관

**한계 레지스터**는 그 프로그램이 기준 레지스터값부터 접근할 수 있는 메모리의 범위를 보관

**사용자모드인 경우에 기준 레지스터와 한계 레지스터를 사용해서 메모리를 보호하게 되고, 커널모드에서는 메모리에 무제한으로 접근하는 것이 가능**



#### 11. CPU 보호

---

CPU가 하나의 프로그램에 의해 독점되는 것을 막기 위해 운영체제는 타이머(timer)라는 하드웨어를 사용

타이머는 정해진 시간이 지나면 인터럽트를 발생시켜 운영체제가 CPU의 제어권을 획득할 수 있도록 하는 역할을 수행



#### 12. 시스템 콜을 이용한 입출력 수행

---

입출력 명령은 모두 특권명령이므로 사용자 프로그램이 직접 수행할 수 없다. 때문에 사용자 프로그램은 운영체제에게 시스템 콜이라는 서비스 대행 요청을 하여 입출력을 수행한다. 

**시스템 콜** : 일종의 소프트웨어적인 인터럽트. 시스템 콜이 일어나면 트랩이 발생해 CPU의 제어권이 운영체제로 넘어감