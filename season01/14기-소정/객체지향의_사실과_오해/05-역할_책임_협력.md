# 역할, 책임, 협력

## 협력

- 요청과 응답으로 연결되는 사람들의 네트워크

앨리스 이야기에서 누군가가 왕에게 재판하라고 요청하고, 요청을 받은 왕은 토끼에게 목격자를 불러오라고 요청한다. 토끼는 모자 장수에게 입장할 것을 요청하고 왕이 다시 모자 장수에게 증언할 것을 요청한다. 이 모든 과정이 협력으로 이루어진다.

## 책임

- 객체가 요청에 대답하거나 적절한 행동을 할 의무가 있는 것
- 객체에 의해 정의되는 응집도 있는 행위의 집합
- 객체 외부에 제공해줄 수 있는 행위와 정보의 목록

객체의 책임은 행위(무엇을 할 수 있는가)와 정보(무엇을 알고 있는가)로 구성된다.

- 행위
    - 객체를 생성하거나 계산을 하는 등 스스로 하는 것
    - 다른 객체의 행동을 시작시키는 것
    - 다른 객체의 활동을 제어하고 조절하는 것
- 정보
    - 개인 정보에 대해 아는 것
    - 관련된 객체에 관해 아는 것
    - 자신이 유도하거나 계산할 수 있는 것에 대해 아는 것

객체의 책임은 외부에서 접근 가능한 공용 서비스 관점에서 이야기 한다. 따라서 책임은 객체의 공용 인터페이스를 구성한다.

### 메시지

- 객체가 다른 객체에게 주어진 책임을 수행하도록 요청하는 것
- 객체가 다른 객체에 접근하는 유일한 방법
- 객체는 요청이 전송됐을 경우에만 책임을 수행

설계는 객체가 협력을 위해 어떤 책임을 수행하고 어떤 객체로부터 메시지를 수신할 것인지 결정하는 것에서 시작해야 한다. 클래스와 메서드를 결정하는 것은 그 다음이다.

## 역할

- 객체가 협력 안에서 수행하는 역할
- 객체가 수행하는 책임의 집합
- 재사용성과 유연한 설계의 중요 요소

앨리스 이야기에서 왕과 여왕은 판사의 역할을, 모자 장수와 앨리스는 증인의 역할을 한다. 역할을 사용하면 왕, 여왕, 모자 장수, 앨리스를 각각 관리할 필요 없이 포괄할 수 있는
하나의 협력으로 추상화할 수 있다.

- 협력 내에서 다른 객체로 대체할 수 있음을 나타낸다.
    - 해당 역할을 수행할 수만 있다면 어떤 객체라도 대신할 수 있다.
    - 동일한 메시지를 이해할 수 있는 객체만 역할을 대체할 수 있다.
    - 동일한 역할 = 동일한 메세지 수신 = 종일한 책임 수행

여왕이 판사 역할을 할 수 있는 이유는 `재판하라`는 매시지를 이해하고 처리할 수 있기 때문이다. 따라서 역할을 대체할 수 있는 객체는 동일한 메시지를 이해할 수 있는 객체로
한정된다.

### 협력의 추상화

- 역할은 하나의 협력에 여러 객체가 참여하게 함으로써 협력을 추상화 한다.
- 단순화된 협력은 설계를 이해하기 쉬워진다.

`왕 - 하얀 토끼 - 모자 장수` 혹은 `여왕 - 하얀 토끼 - 앨리스`의 협력은 `판사 - 하얀 토끼 - 증인` 이라고 추상화함으로써 단순화할 수 있다.

### 대체 가능성

- 객체가 역할을 대체하려면 그 역할의 행동과 책임을 똑같이 수행해야 한다.
- 이외의 다른 책임을 수행할 수도 있다.

모자 장수는 증인 뿐 아니라 모자를 판매하는 책임이 있는 것처럼 객체는 역할이 암시하는 책임보다 더 많은 책임을 가질 수 있다.

## 객체의 모양을 결정하는 협력

### 객체는 데이터를 저장하기 위해 존재한다?

- 객체의 존재 이유는 행위를 수행하고 협력에 참여하는 것이다.
- 데이터를 저장하는 것은 행위를 수행하는데 필요한 재료일 뿐이다.
- 객체의 행동 즉, 책임이 중요하다.

### 객체지향은 클래스의 관계를 표현하는 정적인 개념이다?

- 협력에 참여하는 동적인 객체가 중요하다.
- 클래스는 객체를 표현하고 생성하는 구현 메커니즘일 뿐이다.
- 객체 지향의 핵심은 협력 안에서 객체가 어떤 책임과 역할을 갖는지 결정하는 것이다.

### 올바른 객체 설계

애플리케이션 설계 시 협력이라는 문맥을 고려해야 한다. 객체를 독립적으로 모델링 하지 말고 그 객체가 어떤 협력에 참여하는지 생각해야 한다.

1. 견고하고 깔끔한 협력을 설계한다. 
    - 객체들이 주고받을 요청과 응답의 흐름(=책임)을 결정한다.
    - 이 책임이 객체가 외부에 제공할 행동이다.
2. 행동하는 데 필요한 데이터를 고민한다.
3. 클래스 구현 방법을 결정한다.

## 객체 지향 설계 기법
### 책임 주도 설계

- 협력에 필요한 책임을 식별하고 적합한 객체에게 책임을 할당한다.
- 스스로 처리할 수 없는 정보나 기능은 적절한 객체에게 요청한다.

자세한 절차는 다음과 같다.

1. 시스템이 사용자에게 제공해야 하는 기능(시스템 책임)을 파악한다.
2. 시스템 책임을 더 작은 책임으로 분할한다.
3. 분할된 책임을 수행할 수 있는 적절한 객체나 역할을 찾아 책임을 할당한다.
4. 객체가 책임을 수행하는 중에 도움이 필요하면 이를 책임질 객체나 역할을 찾는다.
5. 해당 객체나 역할에게 책임을 할당한다.

### 디자인 패턴

- 반복적으로 사용하는 솔루현을 정의한 템플릿 모음
- 즉, 이미 식별해놓은 역할, 책임, 협력의 모음이며 책임 주도 설계의 결과다.
- 적절한 디자인 패턴을 알고 있다면 책임 주도 설계 절차 없이도 빠르게 협력 관계를 만들 수 있다.

### 테스트 주도 개발

- 테스트를 통과하는 구체적인 코드를 추가하면서 역할, 책임, 협력을 식별하고 적합한지 피드백 받는다.
- 객체의 역할이 메시지를 수신할 때 어떤 결과를 반환하고 어떤 객체와 협력하는지 코드로 작성한다.
- 깊이 있는 지식과 경험을 요구하는 작업이다.